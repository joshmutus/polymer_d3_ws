<!DOCTYPE html>
<html>
    <head>
        <!--I don't know if these next 3 meta tags are doing anything-->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

        <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
        <link rel="import" href="proto-element.html">
        <link rel="import" href="line-plot.html">
        <link rel="import" href="socket-button.html">
        <link rel="import" href="dir-list.html">
        <link rel="import" href="bower_components/paper-button/paper-button.html">
        <link rel="import" href="bower_components/paper-menu/paper-menu.html">
        <link rel="import" href="bower_components/paper-item/paper-item.html">
        <link href="css/materialize.css" rel="stylesheet" />

        <script src="http://d3js.org/d3.v3.min.js"></script>


  </head>
  <body>
    <div id="foo">asdasdads</div>
    <proto-element></proto-element>
    <br>
    <paper-button raised>button</paper-button>
    <paper-button raised>button2</paper-button>
    <socket-button id = "sb">Socket button</socket-button>
    <!--<dir-list id = "listy"></dir-list>-->
    <grapher-scaffold></grapher-scaffold>
    <notifier-dom prop="6">note</notifier-dom>
    <hearer-element></hearer-element>
    <line-plot></line-plot>

    <script>

    </script>
  </body>
</html>

<dom-module id="grapher-scaffold">
    <template>
        <dir-list id="listy" on-dir-item-clicked="dirHandler"></dir-list>
    </template>

    <script>
        Polymer({
            is: "grapher-scaffold",
            dirSocket: {type: Object},
            dataSocket: {type: Object},
            ready: function () {
                if (!("WebSocket" in window)) WebSocket = MozWebSocket; // firefox

                this.dirSocket = new WebSocket("ws://localhost:8076");
                socket1 = this.dirSocket;

                this.dataSocket = new WebSocket("ws://localhost:8076");
                this.dirSocket.onopen = function (event) {
                    socket1.send('get_dirs');
                }
                console.log("in ready:")
                socket1.onmessage = function (e) {
                    //populate the directory list with content from web socket server

                    newDir = JSON.parse(e.data);
                    for (var j in newDir) {
                        listy.push('dirs', {jim: newDir[j], bob: "bar3"});
                    }
                }
            },
            dirHandler: function (msg) {
                this.dirSocket.send(msg.detail);
                this.dirSocket.onmessage = function (e) {
                    //populate the directory list with content from web socket server
                    console.log(e.data)
                    newDir = JSON.parse(e.data);
                    for (var j in newDir) {
                        listy.push('dirs', {jim: newDir[j], bob: "bar3"});
                    }
                }
            },
//            listeners: {
//                'dirSocket.onmessage': 'dirMsg'
//            },
//
//            dirMsg: function(e){
//                console.log("got a message")
//            }


        });
    </script>
</dom-module>